<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mir: Introducing the Miral API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mir
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Introducing the Miral API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>The <a class="el" href="kiosk__main_8cpp.html#abf9e6b7e6f15df4b525a2e7705ba3089">main()</a> program </h2>
<p>The <a class="el" href="kiosk__main_8cpp.html#abf9e6b7e6f15df4b525a2e7705ba3089">main()</a> program from miral-shell looks like this:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Copyright © 2016-2017 Canonical Ltd.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment"> * under the terms of the GNU General Public License version 2 or 3 as as</span></div><div class="line"><span class="comment"> * published by the Free Software Foundation.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Authored by: Alan Griffiths &lt;alan@octopull.co.uk&gt;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="tiling__window__manager_8h.html">tiling_window_manager.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="floating__window__manager_8h.html">floating_window_manager.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="titlebar__config_8h.html">titlebar_config.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="splash_8h.html">spinner/splash.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="display__configuration__option_8h.html">miral/display_configuration_option.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="runner_8h.html">miral/runner.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="window__management__options_8h.html">miral/window_management_options.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="append__event__filter_8h.html">miral/append_event_filter.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="debug__extension_8h.html">miral/debug_extension.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="internal__client_8h.html">miral/internal_client.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="command__line__option_8h.html">miral/command_line_option.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cursor__theme_8h.html">miral/cursor_theme.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="keymap_8h.html">miral/keymap.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;linux/input.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="kiosk__main_8cpp.html#abf9e6b7e6f15df4b525a2e7705ba3089">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span>* argv[])</div><div class="line">{</div><div class="line">    <span class="keyword">using namespace </span><a class="code" href="namespacemiral.html">miral</a>;</div><div class="line"></div><div class="line">    std::function&lt;void()&gt; shutdown_hook{[]{}};</div><div class="line"></div><div class="line">    <a class="code" href="class_spinner_splash.html">SpinnerSplash</a> spinner;</div><div class="line">    <a class="code" href="classmiral_1_1_internal_client_launcher.html">InternalClientLauncher</a> launcher;</div><div class="line">    <a class="code" href="classmiral_1_1_window_manager_options.html">WindowManagerOptions</a> window_managers</div><div class="line">        {</div><div class="line">            add_window_manager_policy&lt;FloatingWindowManagerPolicy&gt;(<span class="stringliteral">&quot;floating&quot;</span>, spinner, launcher, shutdown_hook),</div><div class="line">            add_window_manager_policy&lt;TilingWindowManagerPolicy&gt;(<span class="stringliteral">&quot;tiling&quot;</span>, spinner, launcher),</div><div class="line">        };</div><div class="line"></div><div class="line">    <a class="code" href="classmiral_1_1_mir_runner.html">MirRunner</a> runner{argc, argv};</div><div class="line"></div><div class="line">    runner.<a class="code" href="classmiral_1_1_mir_runner.html#a381db8f4136d9e057eab666c978a2da9">add_stop_callback</a>([&amp;] { shutdown_hook(); });</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> quit_on_ctrl_alt_bksp = [&amp;](<a class="code" href="group__mir__toolkit.html#gacf322761dc4f8106854e8eaa3f125e6f">MirEvent</a> <span class="keyword">const</span>* event)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group__mir__toolkit.html#ga32dde1ebede4cee1cd059696019e1913">mir_event_get_type</a>(event) != <a class="code" href="group__mir__toolkit.html#gga712a4ef4fc23b2bddc5d7f7377ceaf4aac308c7583545f796a823accd2aef8184">mir_event_type_input</a>)</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">            <a class="code" href="group__mir__toolkit.html#gac6ccf405835223213567284c5f60c894">MirInputEvent</a> <span class="keyword">const</span>* input_event = <a class="code" href="group__mir__toolkit.html#ga0c876dfdffafd6ae1cd23d980d6c5530">mir_event_get_input_event</a>(event);</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group__mir__toolkit.html#gac5ced30132952d26ab9710b2986737bf">mir_input_event_get_type</a>(input_event) != <a class="code" href="group__mir__toolkit.html#gga334b6f462d981b32fd590be762a0ee58a88c9246772cc51cae9e5a216ac98b228">mir_input_event_type_key</a>)</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">            <a class="code" href="group__mir__toolkit.html#ga8ed96fc14f09e59eb1eb256c0c65330e">MirKeyboardEvent</a> <span class="keyword">const</span>* kev = <a class="code" href="group__mir__toolkit.html#gab256f7bfb7ba9e2fa5288ba9bea988f5">mir_input_event_get_keyboard_event</a>(input_event);</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group__mir__toolkit.html#ga216985996513b09de8d62bfb67874176">mir_keyboard_event_action</a>(kev) != <a class="code" href="group__mir__toolkit.html#ggab61bfb7575c845b69bf2932c4c2ab495aaf1ba470e3ac9bb20fb35d6af0c8933e">mir_keyboard_action_down</a>)</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">            <a class="code" href="group__mir__toolkit.html#gaff03b40da711a8377d89fd3a6b1436b1">MirInputEventModifiers</a> mods = <a class="code" href="group__mir__toolkit.html#ga2cd3d56c2dae9e39981da9780249edd8">mir_keyboard_event_modifiers</a>(kev);</div><div class="line">            <span class="keywordflow">if</span> (!(mods &amp; <a class="code" href="group__mir__toolkit.html#ggaf187f39f830b8e179acfbc953f7df377a213764397f09e8a619755b9d455ab834">mir_input_event_modifier_alt</a>) || !(mods &amp; <a class="code" href="group__mir__toolkit.html#ggaf187f39f830b8e179acfbc953f7df377a00796ac9db6d5cb5e61449e5f914679f">mir_input_event_modifier_ctrl</a>))</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group__mir__toolkit.html#ga52256243683d653ceb6663a12684194f">mir_keyboard_event_scan_code</a>(kev) != KEY_BACKSPACE)</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">            runner.stop();</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        };</div><div class="line"></div><div class="line">    <a class="code" href="classmiral_1_1_keymap.html">Keymap</a> config_keymap;</div><div class="line">    <a class="code" href="classmiral_1_1_debug_extension.html">DebugExtension</a> debug_extensions;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> runner.run_with(</div><div class="line">        {</div><div class="line">            <a class="code" href="classmiral_1_1_command_line_option.html">CommandLineOption</a>{[&amp;](std::string <span class="keyword">const</span>&amp; ) { },</div><div class="line">                              <span class="stringliteral">&quot;desktop_file_hint&quot;</span>, <span class="stringliteral">&quot;Ignored for Unity8 compatibility&quot;</span>, <span class="stringliteral">&quot;miral-shell.desktop&quot;</span>},</div><div class="line">            <a class="code" href="classmiral_1_1_cursor_theme.html">CursorTheme</a>{<span class="stringliteral">&quot;default:DMZ-White&quot;</span>},</div><div class="line">            window_managers,</div><div class="line">            <a class="code" href="namespacemiral.html#a7a992b36731bb6543092e39776640ba8">display_configuration_options</a>,</div><div class="line">            launcher,</div><div class="line">            config_keymap,</div><div class="line">            debug_extensions,</div><div class="line">            <a class="code" href="classmiral_1_1_append_event_filter.html">AppendEventFilter</a>{quit_on_ctrl_alt_bksp},</div><div class="line">            <a class="code" href="classmiral_1_1_startup_internal_client.html">StartupInternalClient</a>{spinner},</div><div class="line">            <a class="code" href="namespacemiral.html#aca85bbb801308943981066cd4a6e9059">pre_init</a>(<a class="code" href="classmiral_1_1_command_line_option.html">CommandLineOption</a>{[&amp;](std::string <span class="keyword">const</span>&amp; typeface) { <a class="code" href="namespacetitlebar.html#a5b99362d5b95a5e119870b5568806e46">::titlebar::font_file</a>(typeface); },</div><div class="line">                              <span class="stringliteral">&quot;shell-titlebar-font&quot;</span>, <span class="stringliteral">&quot;font file to use for titlebars&quot;</span>, <a class="code" href="namespacetitlebar.html#a5b99362d5b95a5e119870b5568806e46">::titlebar::font_file</a>()})</div><div class="line">        });</div><div class="line">}</div></div><!-- fragment --><p>This shell is providing <a class="el" href="class_floating_window_manager_policy.html">FloatingWindowManagerPolicy</a>, <a class="el" href="class_tiling_window_manager_policy.html">TilingWindowManagerPolicy</a> and <a class="el" href="class_spinner_splash.html">SpinnerSplash</a>. The rest is from MirAL.</p>
<p>If you look for the corresponding code in lp:qtmir and lp:mir you’ll find it less clear, more verbose and scattered over multiple files.</p>
<p>A shell has to provide a window management policy (miral-shell provides two: <a class="el" href="class_floating_window_manager_policy.html">FloatingWindowManagerPolicy</a> and <a class="el" href="class_tiling_window_manager_policy.html">TilingWindowManagerPolicy</a>). A window management policy needs to implement the <a class="el" href="classmiral_1_1_window_management_policy.html">miral::WindowManagementPolicy</a> interface for handling a set of window management events.</p>
<p>The way these events are handled determines the behaviour of the shell.</p>
<p>The <a class="el" href="classmiral_1_1_window_manager_tools.html">miral::WindowManagerTools</a> interface provides the principle methods for a window management policy to control Mir. </p>
</div></div><!-- contents -->
<hr>
<p align="center">Copyright &copy; 2012-2018
 Canonical Ltd. <br />
Generated on Thu 12 Jul 10:49:10 UTC 2018
</p>
</body>
</html>
